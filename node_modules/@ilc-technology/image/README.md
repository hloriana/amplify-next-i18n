# Image Component

An optimized image component built on top of [next/image](https://nextjs.org/docs/api-reference/next/image)

This library was generated with [Nx](https://nx.dev).

## Usage
Install the component
```bash
npm install @ilc-technology/image
```

Add a no-op configuration to your next project (this is due to a [bug with custom loaders in next](https://github.com/vercel/next.js/issues/21079)). Also configure applicable device sizes here. 

```ts
module.exports = {
// next.config.js
  images: {
    loader: 'imgix',
    path: 'https://noop/',
    deviceSizes: [640, 1080, 1200, 1920],
  },
  ...
}
```

Use the component in your code. 
> Note: you must also import the next image component and pass it as a prop to the MtImage component. This is due to the way the next image component is bundled. 
```typescript
import React from 'react'
import Image from 'next/image'
import { MtImage } from '@ilc-technology/image'


export const MyComponent = () => {

    return <MtImage 
            image={Image} 
            imageUrl="//a.storyblok.com/f/58806/375x600/cadede93a8/ilsu_eu_homepage_mobile.jpg" 
            alt="hero image">
}
```

You can pass any available properties that are available on the `next/image` component, with the exception of `src`, `width`, and `height`. There are a number of other props available as well
|Property|Format|Purpose|
|-----|----|---|
|`size`|`{width: number, height: number}`|Used to set the image size directly|
|`wrapperClassname`|string|css classes to be added to the wrapping of the image|

The component `imageUrl` accepts urls coming from Storyblok(`a.storyblok.com`) or AWS S3 Buckets (`s3.amazonaws.com`). If an image has a url that is not valid for those two sources, it will use a normal `img` element instead of the Next image component.

If the image is from a valid source, the component will use the Storyblok image service to optimize the image and serve it with the Next component. 

## Development
### Developing locally
Please familiarize yourself with the [Nx documentation](https://nx.dev/latest/react/getting-started/getting-started) as it answers most questions. 

>To build the library and have it rebuild automatically with your changes, run `nx build mt-image --watch` .

There is an example Next.js project within this monorepo you can use to test your changes locally. To start it run `nx serve next-image-example`. If you would like to test your changes in another project runnning locally follow these steps _after building the library_:  

1. Run `npm run link:lib --project=mt-image` to link the package to your local npm cache
2. In the consuming project, run `npm link @ilc-technology/image`. It will now point to the locally built version of the library. 

### Publishing Releases
Currently releases of the library have to be done manually. To publish a release of the library do the following from the root of the project. 

1. Run `npm run prepare:lib --project=mt-image --version-bump=<patch, minor, major>`. 
This will version the library and package it for publishing
2. Run `npm run publish:lib --project=mt-image` to publish the packaged library to the EF Registry. 
3. **For changes to the default distribution channel only** commit the update to the projects `package.json` and push it to the repository so the version is maintained. 

>To publish a test version of the library run the command with the `--tag next` to publish to the `next` distribution channel (i.e. running `npm install @ilc-technology/image@next` will pull the test version of the package instead of the version used in production)
