{"version":3,"file":"image-focus.umd.development.js","sources":["../src/helpers/noop.ts","../src/helpers/assign.ts","../src/sharedStyles.ts","../src/retina.svg","../src/FocusPicker.ts","../src/helpers/debounce.ts","../src/FocusedImage.ts"],"sourcesContent":["// tslint:disable-next-line:no-empty\nexport const noop = () => {};\n","export function assign(target: any, ...sources) {\n  sources.forEach(source =>\n    Object.keys(source).forEach(key => (target[key] = source[key]))\n  );\n  return target;\n}\n","export const CONTAINER_STYLES = {\n  position: 'relative',\n  overflow: 'hidden',\n};\n\nexport const ABSOLUTE_STYLES = {\n  position: 'absolute',\n  top: '0',\n  right: '0',\n  bottom: '0',\n  left: '0',\n};\n","const img = \"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3e %3cg fill='none' fill-rule='evenodd'%3e %3ccircle id='a' cx='10' cy='10' r='10' fill='black' fill-opacity='.3' /%3e %3ccircle cx='10' cy='10' r='9' stroke='white' stroke-opacity='.8' stroke-width='2'/%3e %3c/g%3e%3c/svg%3e\";\n  export default img;","import { noop } from './helpers/noop';\nimport { assign } from './helpers/assign';\nimport { CONTAINER_STYLES } from './sharedStyles';\nimport { Focus, FocusPickerOptions } from './interfaces';\n\nimport retina from './retina.svg';\n\nconst IMAGE_STYLES = {\n  // Get rid of bottom padding from default display\n  display: 'block',\n  // Make image fill container\n  maxWidth: '100%',\n  // Prevent Android refresh on pull down\n  touchAction: 'none',\n};\n\nconst RETINA_STYLES = {\n  position: 'absolute',\n  cursor: 'move',\n\n  // Center the retina\n  transform: 'translate(-50%, -50%)',\n};\n\nconst DEFAULT_OPTIONS: FocusPickerOptions = {\n  onChange: noop,\n  retina,\n};\n\nexport class FocusPicker {\n  container: HTMLElement;\n  img: HTMLImageElement;\n  retina: HTMLImageElement;\n  focus: Focus;\n  private isDragging: boolean;\n  private options: FocusPickerOptions;\n  private _enabled: boolean = false;\n\n  constructor(imageNode: HTMLImageElement, options: FocusPickerOptions = {}) {\n    // Merge options in\n    this.options = assign({}, DEFAULT_OPTIONS, options);\n\n    // Set up references\n    this.img = imageNode;\n    this.container = imageNode.parentElement;\n\n    // Styles and DOM config\n    this.img.draggable = false;\n    // Assign styles\n    assign(this.img.style, IMAGE_STYLES);\n    assign(this.container.style, CONTAINER_STYLES);\n\n    // Initialize Focus coordinates\n    this.focus = this.getFocus();\n\n    // Create and attach the retina focal point, start listeners and attach focus\n    this.enable();\n  }\n\n  private getFocus(): Focus {\n    return this.options.focus\n      ? this.options.focus\n      : {\n          x: parseFloat(this.img.getAttribute('data-focus-x')) || 0,\n          y: parseFloat(this.img.getAttribute('data-focus-y')) || 0,\n        };\n  }\n\n  /**\n   * Creates the focal point retina and\n   */\n  public enable() {\n    if (!this._enabled) {\n      // Create and attach the retina focal point\n      this.retina = document.createElement('img');\n      this.retina.src = this.options.retina;\n      this.retina.draggable = false;\n      this.container.appendChild(this.retina);\n      assign(this.retina.style, RETINA_STYLES);\n      this.startListening();\n      this.setFocus(this.focus);\n      this._enabled = true;\n    }\n  }\n\n  public disable() {\n    if (this._enabled && this.retina) {\n      this.stopListening();\n      this.container.removeChild(this.retina);\n      this._enabled = false;\n    }\n  }\n\n  get enabled(): boolean {\n    return this._enabled;\n  }\n\n  public startListening() {\n    // Bind container events\n    this.container.addEventListener('mousedown', this.startDragging);\n    this.container.addEventListener('mousemove', this.handleMove);\n    this.container.addEventListener('mouseup', this.stopDragging);\n    this.container.addEventListener('mouseleave', this.stopDragging);\n    this.container.addEventListener('touchend', this.stopDragging);\n\n    // temporarily cast config objs until this issue is resolved\n    // https://github.com/Microsoft/TypeScript/issues/9548\n    this.container.addEventListener('touchstart', this.startDragging, {\n      passive: true,\n    } as any);\n    this.container.addEventListener('touchmove', this.handleMove, {\n      passive: true,\n    } as any);\n\n    this.img.addEventListener('load', this.updateRetinaPositionFromFocus);\n  }\n\n  public stopListening() {\n    this.container.removeEventListener('mousedown', this.startDragging);\n    this.container.removeEventListener('mousemove', this.handleMove);\n    this.container.removeEventListener('mouseup', this.stopDragging);\n    this.container.removeEventListener('mouseleave', this.stopDragging);\n    this.container.removeEventListener('touchend', this.stopDragging);\n    this.container.removeEventListener('touchstart', this.startDragging);\n    this.container.removeEventListener('touchmove', this.handleMove);\n    this.img.removeEventListener('load', this.updateRetinaPositionFromFocus);\n  }\n\n  public setFocus(focus: Focus) {\n    this.focus = focus;\n    this.img.setAttribute('data-focus-x', focus.x.toString());\n    this.img.setAttribute('data-focus-y', focus.y.toString());\n    this.updateRetinaPositionFromFocus();\n    this.options.onChange(focus);\n  }\n\n  private startDragging = (e: MouseEvent | TouchEvent) => {\n    e.preventDefault();\n    this.isDragging = true;\n    e instanceof MouseEvent\n      ? this.updateCoordinates(e.clientX, e.clientY)\n      : this.updateCoordinates(e.touches[0].clientX, e.touches[0].clientY);\n  };\n\n  private handleMove = (e: MouseEvent | TouchEvent) => {\n    e.preventDefault();\n    if (e instanceof MouseEvent) {\n      this.updateCoordinates(e.clientX, e.clientY);\n    } else {\n      const touch = e.touches[0];\n      const touchedEl = document.elementFromPoint(touch.pageX, touch.pageY);\n      touchedEl !== this.retina && touchedEl !== this.img\n        ? this.stopDragging()\n        : this.updateCoordinates(touch.clientX, touch.clientY);\n    }\n  };\n\n  private stopDragging = () => {\n    this.isDragging = false;\n  };\n\n  private calculateOffsetFromFocus() {\n    const { width, height } = this.img.getBoundingClientRect();\n    const offsetX = width * (this.focus.x / 2 + 0.5);\n    const offsetY = height * (this.focus.y / -2 + 0.5);\n    return { offsetX, offsetY };\n  }\n\n  private updateRetinaPositionFromFocus = () => {\n    this.updateRetinaPosition(this.calculateOffsetFromFocus());\n  };\n\n  private updateRetinaPosition = (offsets: {\n    offsetX: number;\n    offsetY: number;\n  }) => {\n    this.retina.style.top = `${offsets.offsetY}px`;\n    this.retina.style.left = `${offsets.offsetX}px`;\n  };\n\n  private updateCoordinates(clientX: number, clientY: number) {\n    if (!this.isDragging) return; // bail if not dragging\n    const { width, height, left, top } = this.img.getBoundingClientRect();\n\n    // Calculate FocusPoint coordinates\n    const offsetX = clientX - left;\n    const offsetY = clientY - top;\n    const x = (offsetX / width - 0.5) * 2;\n    const y = (offsetY / height - 0.5) * -2;\n\n    // TODO: Figure out an elegant way to use the setFocus API without\n    // having to recalculate the offset from focus\n    this.setFocus({ x, y });\n  }\n}\n","export function debounce(func: Function, debounceTime: number) {\n  let timeout: any;\n  return function debouncedFunction(...args) {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => func(...args), debounceTime);\n  };\n}\n","import { debounce } from './helpers/debounce';\nimport { assign } from './helpers/assign';\nimport { Focus, FocusedImageOptions } from './interfaces';\nimport { CONTAINER_STYLES, ABSOLUTE_STYLES } from './sharedStyles';\n\nconst IMG_STYLES = {\n  // Set these styles in case the image dimensions\n  // are smaller than the container's\n  minHeight: '100%',\n  minWidth: '100%',\n};\n\nconst RESIZE_LISTENER_OBJECT_STYLES = {\n  height: '100%',\n  width: '100%',\n  border: 'none',\n\n  // set these styles to emulate \"visibility: hidden\"\n  // can't use visibility because it breaks the object\n  // events in Firefox\n  opacity: 0,\n  zIndex: -1,\n  pointerEvents: 'none',\n};\n\nconst DEFAULT_OPTIONS: FocusedImageOptions = {\n  debounceTime: 17,\n  updateOnWindowResize: true,\n  updateOnContainerResize: false,\n  containerPosition: 'relative',\n};\n\nexport class FocusedImage {\n  focus: Focus;\n  options: FocusedImageOptions;\n  container: HTMLElement;\n  img: HTMLImageElement;\n  resizeListenerObject: HTMLObjectElement;\n  listening: boolean = false;\n  debounceApplyShift: () => void;\n\n  constructor(\n    private imageNode: HTMLImageElement,\n    options: FocusedImageOptions = {}\n  ) {\n    // Merge in options\n    this.options = assign(DEFAULT_OPTIONS, options);\n\n    // Set up element references\n    this.img = imageNode;\n    this.container = imageNode.parentElement;\n\n    // Set up instance\n    if (this.img['__focused_image_instance__']) {\n      this.img['__focused_image_instance__'].stopListening();\n      this.img.removeEventListener('load', this.applyShift);\n    }\n    this.img['__focused_image_instance__'] = this;\n\n    // Add image load event listener\n    this.img.addEventListener('load', this.applyShift);\n\n    // Set up styles\n    assign(this.container.style, CONTAINER_STYLES);\n    this.container.style.position = this.options.containerPosition;\n    assign(this.img.style, IMG_STYLES, ABSOLUTE_STYLES);\n\n    // Create debouncedShift function\n    this.debounceApplyShift = debounce(\n      this.applyShift,\n      this.options.debounceTime\n    );\n\n    // Initialize focus\n    this.focus = this.options.focus\n      ? this.options.focus\n      : {\n          x: parseFloat(this.img.getAttribute('data-focus-x')) || 0,\n          y: parseFloat(this.img.getAttribute('data-focus-y')) || 0,\n        };\n\n    // Start listening for resize events\n    this.startListening();\n\n    // Set focus\n    this.setFocus(this.focus);\n  }\n\n  public setFocus = (focus: Focus) => {\n    this.focus = focus;\n    this.img.setAttribute('data-focus-x', focus.x.toString());\n    this.img.setAttribute('data-focus-y', focus.y.toString());\n    this.applyShift();\n  };\n\n  public applyShift = () => {\n    const { naturalWidth: imageW, naturalHeight: imageH } = this.img;\n    const {\n      width: containerW,\n      height: containerH,\n    } = this.container.getBoundingClientRect();\n\n    // Amount position will be shifted\n    let hShift = '0';\n    let vShift = '0';\n\n    if (!(containerW > 0 && containerH > 0 && imageW > 0 && imageH > 0)) {\n      return false; // Need dimensions to proceed\n    }\n\n    // Which is over by more?\n    const wR = imageW / containerW;\n    const hR = imageH / containerH;\n\n    // Reset max-width and -height\n    this.img.style.maxHeight = null;\n    this.img.style.maxWidth = null;\n\n    // Minimize image while still filling space\n    if (imageW > containerW && imageH > containerH) {\n      this.img.style[wR > hR ? 'maxHeight' : 'maxWidth'] = '100%';\n    }\n\n    if (wR > hR) {\n      hShift = `${this.calcShift(hR, containerW, imageW, this.focus.x)}%`;\n    } else if (wR < hR) {\n      vShift = `${this.calcShift(wR, containerH, imageH, this.focus.y, true)}%`;\n    }\n\n    this.img.style.top = vShift;\n    this.img.style.left = hShift;\n  };\n\n  public startListening() {\n    if (this.listening) {\n      return;\n    }\n    this.listening = true;\n    if (this.options.updateOnWindowResize) {\n      window.addEventListener('resize', this.debounceApplyShift);\n    }\n    if (this.options.updateOnContainerResize) {\n      const object = document.createElement('object');\n      assign(object.style, RESIZE_LISTENER_OBJECT_STYLES, ABSOLUTE_STYLES);\n      // Use load event callback because contentDocument doesn't exist\n      // until this fires in Firefox\n      object.addEventListener('load', (e: Event) =>\n        object.contentDocument.defaultView.addEventListener('resize', () =>\n          this.debounceApplyShift()\n        )\n      );\n      object.type = 'text/html';\n      object.setAttribute('aria-hidden', 'true');\n      object.tabIndex = -1;\n      this.container.appendChild(object);\n      object.data = 'about:blank';\n      this.resizeListenerObject = object;\n    }\n  }\n\n  public stopListening() {\n    if (!this.listening) {\n      return;\n    }\n    this.listening = false;\n    window.removeEventListener('resize', this.debounceApplyShift);\n    if (\n      this.resizeListenerObject &&\n      this.resizeListenerObject.contentDocument\n    ) {\n      this.resizeListenerObject.contentDocument.defaultView.removeEventListener(\n        'resize',\n        this.debounceApplyShift\n      );\n      this.container.removeChild(this.resizeListenerObject);\n      this.resizeListenerObject = null;\n    }\n  }\n\n  // Calculate the new left/top percentage shift of an image\n  private calcShift(\n    conToImageRatio: number,\n    containerSize: number,\n    imageSize: number,\n    focusSize: number,\n    toMinus?: boolean\n  ) {\n    const containerCenter = Math.floor(containerSize / 2); // Container center in px\n    const focusFactor = (focusSize + 1) / 2; // Focus point of resize image in px\n    const scaledImage = Math.floor(imageSize / conToImageRatio); // Can't use width() as images may be display:none\n    let focus = Math.floor(focusFactor * scaledImage);\n    if (toMinus) focus = scaledImage - focus;\n    let focusOffset = focus - containerCenter; // Calculate difference between focus point and center\n    const remainder = scaledImage - focus; // Reduce offset if necessary so image remains filled\n    const containerRemainder = containerSize - containerCenter;\n    if (remainder < containerRemainder)\n      focusOffset -= containerRemainder - remainder;\n    if (focusOffset < 0) focusOffset = 0;\n\n    return (focusOffset * -100) / containerSize;\n  }\n}\n"],"names":["noop","assign","target","sources","forEach","source","Object","keys","key","CONTAINER_STYLES","position","overflow","ABSOLUTE_STYLES","top","right","bottom","left","IMAGE_STYLES","display","maxWidth","touchAction","RETINA_STYLES","cursor","transform","DEFAULT_OPTIONS","onChange","retina","FocusPicker","imageNode","options","e","preventDefault","isDragging","MouseEvent","updateCoordinates","clientX","clientY","touches","touch","touchedEl","document","elementFromPoint","pageX","pageY","img","stopDragging","updateRetinaPosition","calculateOffsetFromFocus","offsets","style","offsetY","offsetX","container","parentElement","draggable","focus","getFocus","enable","x","parseFloat","getAttribute","y","_enabled","createElement","src","appendChild","startListening","setFocus","disable","stopListening","removeChild","addEventListener","startDragging","handleMove","passive","updateRetinaPositionFromFocus","removeEventListener","setAttribute","toString","getBoundingClientRect","width","height","debounce","func","debounceTime","timeout","debouncedFunction","args","clearTimeout","setTimeout","IMG_STYLES","minHeight","minWidth","RESIZE_LISTENER_OBJECT_STYLES","border","opacity","zIndex","pointerEvents","updateOnWindowResize","updateOnContainerResize","containerPosition","FocusedImage","applyShift","imageW","naturalWidth","imageH","naturalHeight","containerW","containerH","hShift","vShift","wR","hR","maxHeight","calcShift","debounceApplyShift","listening","window","object","contentDocument","defaultView","type","tabIndex","data","resizeListenerObject","conToImageRatio","containerSize","imageSize","focusSize","toMinus","containerCenter","Math","floor","focusFactor","scaledImage","focusOffset","remainder","containerRemainder"],"mappings":"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"}